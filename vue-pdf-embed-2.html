<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Form Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.11.0"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script> -->
    <script src="https://unpkg.com/vue-pdf-embed@1.1.4/dist/vue2-pdf-embed.js"></script>
</head>

<body>
    <div id="app">
        <canvas ref="pdfCanvas"></canvas>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                pathFile: "fill-form.pdf", // ตั้งค่าไฟล์ PDF ที่ต้องการโหลด
                pdfBytes: null
            },
            mounted() {
                this.loadPdf();
            },
            methods: {
                async loadPdf() {
                    try {
                        const response = await fetch(this.pathFile);
                        if (!response.ok) throw new Error("Cannot fetch PDF");

                        this.pdfBytes = new Uint8Array(await response.arrayBuffer());
                        await this.renderPdf();
                    } catch (error) {
                        console.error("Error loading PDF:", error);
                    }
                },
                async renderPdf() {
                    const { PDFDocument } = PDFLib;
                    const pdfDoc = await PDFDocument.load(this.pdfBytes);
                    const form = pdfDoc.getForm();

                    // ใส่ค่าตัวอย่างลงในฟอร์ม
                    const fields = form.getFields();
                    fields.forEach(field => {
                        const fieldName = field.getName();
                        if (field instanceof PDFLib.PDFTextField) {
                            field.setText("ข้อมูลตัวอย่าง");
                        }
                    });

                    const modifiedPdfBytes = await pdfDoc.save();
                    this.displayPdf(modifiedPdfBytes);
                },
                async displayPdf(pdfBytes) {
                    const pdf = await pdfjsLib.getDocument({ data: pdfBytes }).promise;
                    const page = await pdf.getPage(1);
                    const scale = 1.5;
                    const viewport = page.getViewport({ scale });

                    const canvas = this.$refs.pdfCanvas;
                    const context = canvas.getContext("2d");
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    await page.render(renderContext);
                }
            }
        });
    </script>
</body>

</html>