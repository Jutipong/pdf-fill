<html>

<head>
    <meta charset="utf-8" />
    <script src="https://unpkg.com/pdf-lib@1.11.0"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pdf-lib/fontkit@1.1.1/dist/fontkit.umd.min.js"></script>
</head>

<body>
    <iframe id="pdfViewer" width="100%" height="90%"></iframe>
    <br>

    <!-- <p>Click the button to fill form fields in an existing PDF document with <code>pdf-lib</code></p>
    <button onclick="fillForm()">Fill PDF</button>
    <p class="small">(Your browser will download the resulting file)</p> -->
</body>

<script>
    const { PDFDocument } = PDFLib
    const fontkit = window.fontkit

    // โหลดฟอนต์ภาษาไทย (ควรใช้ฟอนต์ที่รองรับ Unicode)
    async function getThaiFont() {
        const fontUrl = 'tahoma.ttf'; // ใส่ path ของฟอนต์ภาษาไทย
        const fontBytes = await fetch(fontUrl).then(res => res.arrayBuffer());
        return fontBytes;
    }


    async function loadPdf() {
        const url = 'https://pdf-lib.js.org/assets/form_to_flatten.pdf'; // URL หรือ path ของไฟล์ PDF
        const existingPdfBytes = await fetch(url).then(res => res.arrayBuffer());

        const pdfDoc = await PDFDocument.load(existingPdfBytes);

        // Set font thai
        pdfDoc.registerFontkit(fontkit);
        const thaiFontBytes = await getThaiFont();
        const customFont = await pdfDoc.embedFont(thaiFontBytes);


        // set value to form
        const form = pdfDoc.getForm()

        form.getTextField('Text1').setText('Some Text');

        form.getRadioGroup('Group2').select('Choice1');
        form.getRadioGroup('Group3').select('Choice3');
        form.getRadioGroup('Group4').select('Choice1');

        form.getDropdown('Dropdown7').select('Infinity');

        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const urlBlob = URL.createObjectURL(blob);



        document.getElementById('pdfViewer').src = urlBlob;




        // Get all fields in the PDF by their names
        // const nameField = form.getTextField('CharacterName 2')
        // const ageField = form.getTextField('Age')
    }

    loadPdf();

    async function fillForm() {
        // Fetch the PDF with form fields
        const formUrl = 'https://pdf-lib.js.org/assets/form_to_flatten.pdf'
        const formPdfBytes = await fetch(formUrl).then(res => res.arrayBuffer())

        // Load a PDF with form fields
        const pdfDoc = await PDFDocument.load(formPdfBytes)

        // Get the form containing all the fields
        const form = pdfDoc.getForm()

        // Fill the form's fields
        form.getTextField('Text1').setText('Some Text');

        form.getRadioGroup('Group2').select('Choice1');
        form.getRadioGroup('Group3').select('Choice3');
        form.getRadioGroup('Group4').select('Choice1');

        form.getCheckBox('Check Box3').check();
        form.getCheckBox('Check Box4').uncheck();

        form.getDropdown('Dropdown7').select('Infinity');

        form.getOptionList('List Box6').select('Honda');

      // Flatten the form's fields
      /* form.flatten() */;

        // Serialize the PDFDocument to bytes (a Uint8Array)
        // const pdfBytes = await pdfDoc.save()

        // Trigger the browser to download the PDF document
        // download(pdfBytes, "pdf-lib_form_flattening_example.pdf", "application/pdf");
    }
</script>

</html>